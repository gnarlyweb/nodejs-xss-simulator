<!doctype html>
<html>
 	<head>

		<title>XSS Simulator</title>
		
		<!-- <link rel="stylesheet" href="stylesheet.css"> -->

		<script src="/socket.io/socket.io.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

        <script>
        
        var now = new Date();
        var socket = io();
        
        </script>

    </head>

    <body>
        <textarea rows=20 cols=50 id="text-field"></textarea><br>
        <input type="checkbox" id="renderAsHTML" value=false><label for="renderAsHTML">Render the below text as HTML (note: any scripts will be executed)!</label>
        <br>
        <p id="tgh"></p>
    </body>

    <script>

    var text_field = document.getElementById("text-field");
    var tgh = document.getElementById('tgh');
    var renderHTML = document.getElementById("renderAsHTML");

    renderHTML.oninput = function () {
        if (renderHTML.checked) {
            tgh.innerHTML = tgh.innerText;
        } else {
            tgh.innerText = tgh.innerHTML;
        }
    };

    text_field.oninput = function () {
        console.log("sending: " + text_field.value);
        
        if (renderHTML.checked) {
            tgh.innerHTML = text_field.value;
        } else {
            tgh.innerText = text_field.value;
        }

        socket.emit('ctfc', text_field.value);
    };

    socket.on('stfc', function (new_text) {
        console.log("Outbound new text: " + new_text);
        text_field.oninput = undefined;

        if (renderHTML.checked) {
            tgh.innerHTML = new_text;
        } else {
            tgh.innerText = new_text;
        }

        text_field.value = new_text;
        text_field.oninput = function () {
            socket.emit('ctfc', text_field.value);
        };
    });

    </script>

